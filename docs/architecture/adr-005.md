## ADR-005: Parallel Execution and Plan Caching

**Status:** Accepted
**Date:** 2025-10-14

### Context

Sequential planning and applying of 20–30 stacks could cause CI jobs to exceed reasonable execution time.
Also, repeated re-planning of unchanged stacks wasted compute, API calls and developer time.ß

### Decision

Implement parallel orchestration and per-stack plan caching:

Build a DAG from dependencies.json and execute independent layers concurrently (goroutines + WaitGroups).

Limit concurrency with --parallelism (default: 4).

Cache plan files and hash checksums in .terraform-wrapper/cache/<env>/<stack>/.

Skip unchanged stacks unless --force-plan is passed.

### Consequences

Reduced plan/apply times in CI.
Deterministic dependency-aware concurrency.
Improved repeatability and cache reuse between runs.
Parallelization increases the need for global locking and clean logging.
Cache invalidation depends on hash accuracy (inputs, vars, dependencies).