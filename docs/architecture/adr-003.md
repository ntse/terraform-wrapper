## ADR-003: Adopt “Superplan” Model

**Status:** Accepted
**Date:** 2025-10-14

### Context

We wanted a way to see how updates across multiple stacks would collectively affect our infrastructure without merging all states into a single monolithic backend, which would increase blast radius for failures or drifts which removed the main benefit of our per-stack Terraform structure.

We also discovered that Terraform plans would fail in CI when a stack attempted a cross-stack data lookup (e.g. using a data "aws_route_53" reference) before the upstream stack had been applied. This made it difficult to generate consistent, environment-wide plans and resulted in failed pipelines having to be merged.

###  Decision

Adopt a superplan approach:

Download all stack states from S3.

Merge them locally (with prefixed resource names).

Generate a unified Terraform plan for visibility only (not applied).

Keep applies fully decentralized (per-stack backend).

### Consequences

Enables cross-stack impact analysis (e.g., “core-services/network” affects “ecs”).
Keeps per-stack isolation and locking intact.
Requires name-prefixing logic to avoid resource conflicts once we merge many namespaces together.
Local superplan is a transient artifact so applies must still be run per stack.