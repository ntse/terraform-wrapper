## ADR-011: Excluding Tags from Superplan State Merge

**Status:** Accepted  
**Date:** 2025-10-15

### Context

The superplan feature merges state from every stack into a single read-only plan so that environment-wide changes can be reviewed before apply. Resource tags (`tags`, `tags_all`, `default_tags`) differ across stacks and environments, and do not affect dependency ordering. Including them in the merged state introduced large, noisy diffs that obscured structural changes and slowed reviews.

### Decision

During superplan generation, omit tag attributes from the merged state:

- Remove tag-related keys while rewriting resources and outputs.
- Preserve all other attributes to keep dependency and drift analysis intact.
- Document that tag drift should be inspected at the individual stack level.

### Rationale

- Tag differences rarely influence orchestration decisions, yet they produce persistent churn in plan output.
- Smaller diffs improve signal-to-noise, making it easier to spot real infrastructure changes.
- Simplifies state rewriting logic; we no longer need to reconcile tag maps across stacks.

### Alternatives Considered

- Preserve tags and rely on reviewers to ignore them: failed in practice because tag updates drowned out meaningful changes.
- Normalise tags across stacks before merging: complex and still leaves noise when stacks intentionally diverge.

### Consequences

- Superplan diffs focus on structural resources, data sources, and provider configuration.
- Tag drift must be monitored via stack-level plans or reports; the superplan alone cannot highlight missing tags.
- The list of tag attributes needs occasional maintenance as providers introduce new tag fields.
